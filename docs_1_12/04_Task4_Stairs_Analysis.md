# 项目报告：Task 4 楼梯特训 (Phase 3)

## 1. 任务概述
**目标**：在 Task 3 (抗干扰) 的鲁棒性基础上，攻克复杂地形中最难的一关——楼梯 (Stairs)。
**挑战**：盲视 (Blind) 状态下，机器人不知道前方台阶的高度和宽度，只能依靠本体感知 (Proprioception) 来判定落足点。

## 2. 训练现象与分析 (从激进到稳健)

### 2.1 "冲刺下楼" 现象 (The Sprinting Issue)
在 Phase 3 初期，我们观察到机器人上楼梯非常凶猛（得益于 Phase 2 的抗干扰刚度），但在下楼梯时表现得过于激进，像是在“跑”下楼，导致步幅过大而摔倒。

*   **原因分析**：
    1.  **惯性思维**：Phase 2 训练了它“为了不倒必须快走”，这个策略在下楼梯时是致命的。
    2.  **重力势能**：下楼时重力会自然加速机器人，如果它不主动制动 (Brake)，速度会越来越快。
    3.  **盲视恐惧**：机器人看不见台阶并没有底，它可能认为自己在平地上被推了一把，于是试图通过加速迈步来维持平衡。

### 2.2 解决方案：调整速度引导与地形难度
*   **速度命令 (Velocity Command) 究竟是谁定的？**
    *   在训练时 (Train)：是由 `env_cfg` 中的 `commands` 范围随机生成的。
    *   在模型里 (Model)：模型**学习**去跟随这个命令。
    *   **修正**：我们在 Phase 3 中明确限制了速度指令的范围，尤其是在下楼梯时，不应该给它发出的“冲刺”指令。
    ```python
    # 修改后的命令范围
    self.commands.base_velocity.ranges.lin_vel_x = (0.3, 0.6) # 强制慢速
    ```

*   **台阶高度 (Terrain Difficulty)**
    *   我们在 `terrain_levels` 曲线中观察到的攀升，实际上是 Isaac Lab 的**自动课程系统 (Curriculum)** 在工作。
    *   并不是我们手动调低了高度，而是环境发现机器人“太强了”，自动把台阶变高了。
    *   **对策**：如果它在 Level 0.9 (最高台阶) 摔得很惨，我们可以手动限制 `max_terrain_level`，或者修改地形生成的配置，把最大台阶高度从默认的 20cm 调低到 15cm。

## 3. Loss Value Function 的尖峰 (Spikes) 分析
*(针对您提到的三个尖峰)*

在 `Loss/value_function` 图表中出现的剧烈尖峰：
*   **不是噪音 (Not Noise)**：这是非常典型的 **"Curriculum Leap" (课程跃迁)** 现象。
*   **解释**：
    1.  当机器人在当前难度（比如 Level 3）表现完美时，环境会自动把它扔到下一级难度（Level 4，台阶更高）。
    2.  在新难度下，旧的价值估计 (Value Function) 瞬间失效（它以为这步能踩稳，结果踏空了），导致 `Value Loss` 瞬间飙升。
    3.  随后 Loss 迅速回落，说明它适应了新难度。
*   **结论**：这三个尖峰分别对应了它攻克 “低台阶 -> 中台阶 -> 高台阶” 的三个关键突破时刻。

## 4. 最终微调建议
为了解决“下楼太快”的问题，我们在最终版配置中采取了以下措施：
1.  **增加 Z 轴速度惩罚** (`pen_lin_vel_z`)：强迫它在垂直方向上动作更轻柔，不能“砸”向地面。
2.  **降低 X 轴速度奖励上限**：即使它跑得快，也不给额外分，引导它佛系一点。
