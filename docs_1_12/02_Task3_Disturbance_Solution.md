# 项目报告：Task 3 抗干扰训练 (Phase 2)

## 1. 任务概述
**目标**：在 Task 2 (平地行走) 的基础上，训练机器人抵抗外部强力推搡 (Push) 的能力。
**方法**：使用 Curriculum Learning (课程学习)，加载 Task 2 的模型权重，开启随机外力事件。

## 2. 关键配置与修改

### 2.1 引入外力干扰 (The Disturbance)
在 `PFDisturbanceRejectionEnvCfg` 中，我们并没有改变地形，而是利用了 Isaac Lab 的事件系统：

```python
# 伪代码示意
self.events.push_robot = EventTerm(
    func=mdp.push_by_setting_velocity,
    mode="interval",
    interval_range_s=(5.0, 10.0),  # 每 5-10 秒推一次
    params={"velocity_range": {"x": (-1.0, 1.0), "y": (-1.0, 1.0)}} # 瞬间赋予 1m/s 的横向/纵向速度
)
```
*   **设计思路**：我们不使用持续的风力，而是使用瞬间的**冲量 (Impulse)**。这对足式机器人最危险，因为它们必须在下一个落足点瞬间计算出支撑位置，否则就会交叉腿绊倒。

### 2.2 奖励函数的微调 (Trade-off)
为了应对干扰，我们必须牺牲一部分 Task 2 中获得的“优雅性”。

*   **提高 `rew_base_stability` (2.0)**：
    当被推歪时，机器人需要迅速把身体姿态 (Pitch/Roll) 修正回来。这个奖励项鼓励它快速回正。
*   **接受更高的 `pen_action_smoothness` 惩罚**：
    从 Phase 2 的训练曲线可以看到，平滑性惩罚变大了。这是由于机器人为了平衡，必须做出高频、大幅度的“碎步”调整。我们接受这种“丑陋但有效”的动作。

## 3. 训练效果分析
*(此处插入您刚才提供的 Phase 2 训练曲线截图)*

*   **震荡的生存曲线 (`Episode Length`)**：
    相比 Task 2 的一条直线，Task 3 的生存曲线在高位剧烈震荡。
    **解读**：这不仅不是坏事，反而是**训练有效的铁证**。
    *   如果曲线是一条直线：说明推力太小，机器人根本没感觉。
    *   如果曲线掉到底：说明推力太大，机器人一推就倒。
    *   **高位震荡**：说明机器人在“摔倒”和“救回”的边缘疯狂试探。每一次震荡，都是一次失败的教训；每一次回升，都是一次成功的策略进化。

*   **奖励的攀升 (`Mean Reward` 350 -> 750)**：
    虽然生存很艰难，但总奖励在飙升。这说明机器人学会了：
    1.  平时走直线拿分。
    2.  被推时，立刻放弃走直线，优先保命（减少摔倒带来的巨大惩罚）。
    3.  稳住后，迅速恢复走直线继续拿分。

## 4. 为什么不直接上楼梯？(Phase 2 的必要性)
既然最终目标是爬楼梯，为什么中间要插一个“平地抗干扰”？

*   **鲁棒性传递 (Robustness Transfer)**：
    楼梯行走本质上是一种“连续的、可预测的干扰”。如果机器人连平地上的随机干扰都处理不了，它在楼梯上踏空（相当于一种干扰）的瞬间就会立刻翻滚。
*   **脚部刚度**：
    抗干扰训练通常会训练出更“硬”的腿部控制策略（更高的 KPI/KDI 响应），这种刚度对于支撑楼梯边缘至关重要。

## 5. Play 模式的改进
我们在 Phase 2 的 Play 模式中修复了一个对人类观察者不友好的问题：
*   **问题**：绿色指令箭头变换频率太快 (1-2秒)，人类看不清机器人是否跟上。
*   **修复**：将 `resampling_time_range` 调整为 **(5.0, 8.0)** 秒。
